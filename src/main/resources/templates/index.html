<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{steampowered.css}">
    <meta charset="UTF-8">
    <title>SteamPowered Main Page</title>
</head>
<body>
    <!--Used to grab the values from steam openID-->
    <tr class="openid-results" th:each="entry : ${parameters}">        
    </tr>
<div class="top-border">
    <h1>SteamPowered</h1> <!-- TITLE TEXT -->
    <div class="tab-bar"> <!-- NAVIGATION BAR -->
        <div class="tab"><a th:href="@{profile}">PROFILE</a></div>
        <div class="tab"><a th:href="@{multiplayer}">MULTIPLAYER</a></div>
        <div class="tab"><a th:href="@{/redirect}">OpenID</a></div>
    </div>
</div>

<div class="content">
    <!-- Spinning Wheel Section -->
    <h2></h2>
    <div id="wheel">
        <canvas id="wheelCanvas" width="500" height="500"></canvas>
    </div>
    <button id="spin">Spin the Wheel!</button>
    <p id="result" style="text-align:center; font-size:20px;"></p>
</div>

<div class="bottom-border"></div>

<!--CREATION OF WHEEL AREA AND SECTIONS FOR TESTING/SET TO CHANGE -->
<script>const canvas = document.getElementById('wheelCanvas');
const ctx = canvas.getContext('2d');
const sections = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];
let currentRotation = 0;

//WHEEL CREATION
function drawWheel() {
    const sectionAngle = 2 * Math.PI / sections.length;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < sections.length; i++) {
        ctx.beginPath();
        ctx.moveTo(250, 250); // Wheel center
        ctx.arc(250, 250, 250, sectionAngle * i, sectionAngle * (i + 1), false);
        ctx.closePath();
        ctx.fillStyle = i % 2 === 0 ? '#FFF' : '#DDD';
        ctx.fill();
        ctx.stroke();

        //TEXT ON WHEEL
        ctx.fillStyle = '#000';
        ctx.font = '20px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        const textAngle = sectionAngle * i + sectionAngle / 2;
        const textX = 250 + Math.cos(textAngle) * 200 * 0.5;
        const textY = 250 + Math.sin(textAngle) * 200 * 0.5;
        ctx.fillText(sections[i], textX, textY);
    }
}

//ARROW POINTER
function drawArrow() {
    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.moveTo(500, 250);
    ctx.lineTo(470, 230);
    ctx.lineTo(470, 270);
    ctx.closePath();
    ctx.fill();
}

//SPIN WHEEL
function spinWheel() {
    const spinTo = Math.random() * 7200;
    const duration = 5000;

    const start = Date.now();
    const spin = () => {
        const timePassed = Date.now() - start;
        const progress = timePassed / duration;
        const angle = spinTo * progress;

        currentRotation = angle % 360;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(250, 250);
        ctx.rotate(angle * Math.PI / 180);
        ctx.translate(-250, -250);
        drawWheel();
        ctx.restore();
        drawArrow();

        if (timePassed < duration) requestAnimationFrame(spin);
        else {
            const landedSectionIndex = Math.floor(((360 - currentRotation) % 360) / (360 / sections.length));
            showResultAndButtons(sections[landedSectionIndex]);
            const resultText = `Landed on section: ${sections[landedSectionIndex]}`;
            document.getElementById('result').textContent = resultText;
        }
    };
    requestAnimationFrame(spin);
}
function showResultAndButtons(result) {


    //PREVENTS DUPLICATES
    const existingReshuffleBtn = document.getElementById('reshuffle');
    const existingGoToGameBtn = document.getElementById('goToGame');
    if (existingReshuffleBtn) existingReshuffleBtn.remove();
    if (existingGoToGameBtn) existingGoToGameBtn.remove();

    //RESHUFFLE GAMES
    const reshuffleBtn = document.createElement('button');
    reshuffleBtn.id = 'reshuffle';
    reshuffleBtn.innerText = 'Reshuffle ';
    reshuffleBtn.className = 'action-button'; // Use the same class as the spin button for consistent styling
    reshuffleBtn.addEventListener('click', function() {
        // Add logic for what happens when "Reshuffle Games" is clicked
        console.log('Reshuffling games...');
    });

    //GO TO GAME BUTTON
    const goToGameBtn = document.createElement('button');
    goToGameBtn.id = 'goToGame';
    goToGameBtn.innerText = 'Go to Game';
    goToGameBtn.className = 'action-button'; // Use the same class as the spin button for consistent styling
    goToGameBtn.addEventListener('click', function() {
        // Add logic for what happens when "Go to Game" is clicked
        console.log('Going to game...');
    });

    //BUTTONS APPEND
    const buttonsContainer = document.getElementById('spin').parentNode;
    buttonsContainer.appendChild(reshuffleBtn);
    buttonsContainer.appendChild(goToGameBtn);
}

document.getElementById('spin').addEventListener('click', spinWheel);

drawWheel();
drawArrow();
</script>
</body>
</html>